{% extends "mspsds-layout.html" %}
{% set currentPage      = 'case' %}
{% set currentCase = data.cases | withId(data['caseid']) %}
{% set currentCase = currentCase | attachCaseChildren(data) %}
{% set currentTeam = data.currentTeam %}

{% if bodyClasses %}
    {% set bodyClasses = bodyClasses + " mspsds-width-container case" %}
{% else %}
    {% set bodyClasses = " mspsds-width-container case" %}
{% endif %}

{% set navActive = 'cases' %}

{% set caseNavActive = 'overview' %}
{% set hasEditRights = true if (currentCase.assignee == data['currentUser']) else false %}

{% set significantDateLabel = "Last updated" if currentCase.activities.length > 1 else "Created" %}




{% block pageTitle %}
{% endblock %}

{% block header %}
  {{ super() }}
  {% set includeCaseActions = true %}

  {% include "includes/components/case/case-bar.html" %}

{% endblock %}

{% block beforeContent %}

{% endblock %}

{% set summaryMetadataRows = [
    {
      key: {
        text: "Status"
      },
      value: {
        text: currentCase.status
      },
      actions: {
        items: [
          {
            href: "/root/flows/change-status/01",
            text: "Change",
            visuallyHiddenText: "case status",
            classes: "govuk-link--no-visited-state" 
          } if hasEditRights else []
        ]

      }
    },
    {
      key: {
        text: "Assigned to" if (currentCase.status=="Open") else "Owner"
      },
      value: {
        text: currentCase.assignee
      },
      actions: {
        items: [
          {
            href: "/root/flows/assign/01",
            text: "Change",
            visuallyHiddenText: "assignee",
            classes: "govuk-link--no-visited-state" 
          } if hasEditRights else []
        ]
      }
    },
    {
      key: {
        text: "Created by"
      },
      value: {
        text: "Ed Horsford"
      },
      actions: {
        items: []
      }
    },
    {
      key: {
        text: significantDateLabel
      },
      value: {
        text: currentCase.dateUpdated | prettifyDate,
        text: "Yesterday"
      },
      actions: {
        items: [
          {
            href: "/root/flows/add-activity/01?currentPage=case&caseid="+currentCase.id,
            text: "Add activity",
            classes: "govuk-link--no-visited-state" 
          }
        ]
      } if hasEditRights else {
        items: [
            {
              href: "/root/flows/add-comment/01-add-comment",
              text: "Add comment"
            }
          ]
        }
      }
  ] %}

{# Not used

,
    {
      key: {
        text: "Watchers"
      },
      value: {
        text: "3 watchers"
      },
      actions: {
        items: [
          {
            href: "#",
            text: "View / edit",
            visuallyHiddenText: "contact details"
          }
        ]
      }
    },
    {
      key: {
        text: "Edit rights"
      },
      value: {
        text: "4 with edit rights"
      },
      actions: {
        items: [
          {
            href: "#",
            text: "View / edit",
            visuallyHiddenText: "contact details"
          }
        ]
      }
    }
     #}



{% block content %}

{% include "includes/components/case/case-navigation.html" %}



<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h1 class="govuk-heading-l">Overview</h1>

    <p class="govuk-body-l">ChargeWorx adaptor, Electric shock, fire hazard</p>

    <h2 class="govuk-heading-m">Summary</h2>

    <p class="govuk-body">The hood of the jacket has cords with free ends in the neck area.
    These cords can become trapped during various activities of the child, leading to strangulation.

    The product does not comply with the relevant European standard 14682.</p>

    <p class="govuk-body psd--inline-link right-align"><a href="" class="govuk-link govuk-link--no-visited-state">Change summary</a></p>

    <h2 class="govuk-heading-m">About the case</h2>

    {{ govukSummaryList({
      rows: summaryMetadataRows
    }) }}

    <h2 class="govuk-heading-m">Product</h2>

  {% set hazardDescription %}
    <p class="govuk-body">The internal wiring can become loose and make the main case live.</p>
  {% endset %}

  {% set hazardHTML %}
    <p class="govuk-body">Electrocution</p>

    {{hazardDescription | safe}}
  {% endset %}

  {{ govukSummaryList({
    rows: [
      {
        key: {
          text: "Product category"
        },
        value: {
          text: "Low-voltage electrical"
        },
        actions: {
          items: [
            {
              href: "#",
              text: "Change",
              visuallyHiddenText: "hazard type"
            }
          ]
        }
      },
      {
        key: {
          text: "Hazards",
          classes: "govuk-summary-list--no-border"
        },
        classes: "govuk-summary-list--no-border",
        value: {
          html: hazardHTML
        },
        actions: {
          items: [
            {
              href: "#",
              text: "Change",
              visuallyHiddenText: "hazard type"
            }
          ]
        }
      },
      {
        key: {
          text: "Compliance"
        },
        value: {
          text: "No known compliance issues"
        },
        actions: {
          items: [
            {
              href: "#",
              text: "Change",
              visuallyHiddenText: "contact details"
            }
          ]
        }
      }
    ]
  }) }}

  <h2 class="govuk-heading-m">Reporter</h2>

  {% set reporterContactHTML %}
  <p class="govuk-body">Ed Horsford</p>
  <p class="govuk-body">ed.horsford@suffolk.trading-standards.gov.uk</p>
  <p class="govuk-body">0798989898979</p>

  {% endset %}

  {% set reportSourceHTML %}
    <p class="govuk-body">Trading Standards Suffolk</p>

    {# <p class="govuk-body">TS reference number: J58484739A</p> #}
  {% endset %}

  {# {{ govukSummaryList({
    rows: [
      {
        key: {
          text: "Report source"
        },
        value: {
          html: reportSourceHTML
        },
        actions: {
          items: [
            {
              href: "#",
              text: "Change",
              visuallyHiddenText: "hazard type"
            }
          ]
        }
      },{
        key: {
          text: "TS reference number"
        },
        value: {
          text: "J59398383838"
        },
        actions: {
          items: [
            {
              href: "#",
              text: "Change",
              visuallyHiddenText: "hazard type"
            }
          ]
        }
      },
      {
        key: {
          text: "Contact details"
        },
        value: {
          html: reporterContactHTML
        },
        actions: {
          items: [
            {
              href: "#",
              text: "Change",
              visuallyHiddenText: "reference number"
            }
          ]
        }
      }
    ]
  }) }} #}

  {# Raw HTML as component doesn't support change links spanning sections #}
    <dl class="govuk-summary-list">
      <div class="govuk-summary-list__row govuk-summary-list--no-border">
        <dt class="govuk-summary-list__key">
          Report source
        </dt>
        <dd class="govuk-summary-list__value">
          <p class="govuk-body">Trading Standards Suffolk</p>
        </dd>
        
        <div class="govuk-summary-list__actions">
          <a class="govuk-link" href="#">
            Change<span class="govuk-visually-hidden"> report source</span>
          </a>
        </div>      
      </div>

      <div class="govuk-summary-list__row">
        <dt class="govuk-summary-list__key">
          TS reference number
        </dt>
        <dd class="govuk-summary-list__value">
          J59398383838
        </dd>
        
        <div class="govuk-summary-list__actions">
        </div>     
      </div>

      <div class="govuk-summary-list__row">
        <dt class="govuk-summary-list__key">
          Contact details
        </dt>
        <dd class="govuk-summary-list__value">
          <p class="govuk-body">Ed Horsford</p>
          <p class="govuk-body">ed.horsford@suffolk.trading-standards.gov.uk</p>
          <p class="govuk-body">0798989898979</p>
        </dd>
        
        <dd class="govuk-summary-list__actions">
          <a class="govuk-link" href="#">
            Change<span class="govuk-visually-hidden"> reporter contact details</span>
          </a>
        </dd>     
      </div>
    </dl>
  </div>
  <div class="govuk-grid-column-one-third">
    <aside class="app-related-items" role="complementary">
      <h2 class="govuk-heading-m" id="subsection-title">
        Product
      </h2>

      <h3 class="govuk-heading-s">ChargeWorx adaptor</h3>
      <div class="product-image__container">
        <img src="/public/images/slapwrap1.jpg" title="Product identifying image" />
      </div>
      

      <p class="govuk-body">
        <a href="#" class="govuk-link">View product</a>&nbsp;
      </p>




    </aside>

  </div>
</div>


{% endblock %}
